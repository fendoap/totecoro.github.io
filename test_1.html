<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <title>スライダーでシンセの周波数を変える</title>
</head>
<body>
  <h1>スライダーでシンセを操作するデモ</h1>

  <!-- 周波数を表示するラベル -->
  <label for="freqSlider">
    Frequency: <span id="freqLabel">440</span> Hz
  </label>
  <br />
  <!-- スライダー（100Hz ～ 2000Hz を指定） -->
  <input
    type="range"
    id="freqSlider"
    min="100"
    max="2000"
    value="440"
    step="1"
  />

  <br /><br />
  <!-- 音を鳴らすためのボタン -->
  <button id="playBtn">Play Note</button>

  <!-- Tone.js を CDN から読み込む -->
  <script src="https://cdn.jsdelivr.net/npm/tone@latest/build/Tone.js"></script>
  <script>
    document.addEventListener("DOMContentLoaded", () => {
      // 1) Tone.js のシンセを生成してスピーカーに接続
      const synth = new Tone.Synth({
        oscillator: { type: "sine" },
        envelope: { attack: 0.01, decay: 0.1, sustain: 0.5, release: 1 },
      }).toDestination();

      // 2) スライダー要素とラベル要素をキャッシュ
      const freqSlider = document.getElementById("freqSlider");
      const freqLabel = document.getElementById("freqLabel");

      // 3) スライダーの input イベントで周波数を更新
      freqSlider.addEventListener("input", (e) => {
        const freqValue = e.target.value;          // スライダーの数値 (文字列)
        freqLabel.textContent = freqValue;         // ラベルに表示を反映
        synth.frequency.value = Number(freqValue); // シンセの周波数を更新
        console.log("周波数を更新しました:", freqValue);
      });

      // 4) ボタンをクリックしたら音を鳴らす
      const playBtn = document.getElementById("playBtn");
      playBtn.addEventListener("click", async () => {
        // ブラウザのオーディオ再生許可を解除
        await Tone.start();
        // 現在の周波数（synth.frequency.value）で "C4" ではなく周波数そのもので鳴らす例
        // 短いクリック音の例として、現在の周波数で 0.5 秒だけ鳴らす
        synth.triggerAttackRelease(synth.frequency.value, 0.5);
        console.log("音を再生:", synth.frequency.value);
      });
    });
  </script>
</body>
</html>
